\section{PIT Histograms}

In this section, we will look at the PIT histograms of the different forecasting models. 

Let \(F\) denote a CDF for an observation \(Y\). The probability integral 
transform (PIT) of \(F\) is the random variable \(Z_F = F(Y-) + V(F(Y) - F(Y-))\) 
where \(V \sim U(0,1)\). 
The probabiliy integral transform is the value that the predictive CDF 
attains at the observation \(Y\). \Textcite{Rueschendorf2009} shows that if \(Y \sim F\), \(Z_F\) is standard uniformly distributed.

\Textcite{Gneiting2014} define the different dispersion types as follows:
The PIT is used to evaluate the probabilistic calibration of a forecast. 
A forecast \(F\) is probabilistically calibrated if its PIT \(Z_F\) 
is uniformly distributed on the unit interval. 
It is called overdispersed if \(\mathrm{var}(Z_F) < \frac{1}{12}\) or if 
the PIT histogram has a \(\cap\)-shape. We get underdispersion if 
\(\mathrm{var}(Z_F) > \frac{1}{12}\) or if the PIT histogram has a \(\cup\)-shape. 
A forecast is neutrally dispersed if \(\mathrm{var}(Z_F) = \frac{1}{12}\).
Overdispersion indicate a too high estimated variance and underdispersion indicate 
that the variance of the forecast is too low. 
Figure \ref{fig:dispersion} shows a PIT with \(\mathrm{var}(Z_F) < \frac{1}{12}\), 
\(\mathrm{var}(Z_F) = \frac{1}{12}\) as well as a PIT with \(\mathrm{var}(Z_F) > \frac{1}{12}\), 
i.e., an overdispersed, a probabilistically calibrated and therefore neutrally dispersed as well as an underdispersed forecast.

\begin{figure}[h]%
    \centering
    \subfloat[\centering Overdispersed]{{\includegraphics[width=0.3\textwidth]{plots/pit/overdispersed.pdf} \label{fig:pit-overdispersed} }}
    \subfloat[\centering Neturally dispersed]{{\includegraphics[width=0.3\textwidth]{plots/pit/neutrally_dispersed.pdf} \label{fig:pit-neutrally-dispersed} }}
    \subfloat[\centering Underdispersed]{{\includegraphics[width=0.3\textwidth]{plots/pit/underdispersed.pdf} \label{fig:pit-underdispersed} }}
    \caption[Dispersion types for PITs]{Dispersion types for PITs. The PIT of an overdispersed forecast is formed like a \(\cap\) (Figure \ref{fig:pit-overdispersed}). 
    Figure \ref{fig:pit-neutrally-dispersed} is probabilistically calibrated, i.e. \(Z_F \sim U(0,1)\), and therefore neutrally dispersed. 
    An underdispersed forecast has a PIT that looks like a \(\cup\) (Figure \ref{fig:pit-underdispersed}).}%
    \label{fig:dispersion}%
\end{figure}

\begin{figure}[h]%
    \centering
    \subfloat[\centering Quantile Random Forests]{{\includegraphics[width=0.45\textwidth]{plots/pit/pit_qrf.pdf} \label{fig:pit-qrf} }}
    \subfloat[\centering Nearest Neighbor Quantile Filters]{{\includegraphics[width=0.45\textwidth]{plots/pit/pit_nnqf.pdf} \label{fig:pit-nnqf} }} \\
    \subfloat[\centering DeepAR]{{\includegraphics[width=0.45\textwidth]{plots/pit/pit_deepar.pdf} \label{fig:pit-deepar} }}
    \subfloat[\centering Spline Quantile Functions RNN]{{\includegraphics[width=0.45\textwidth]{plots/pit/pit_sqf-rnn.pdf} \label{fig:pit-sqf-rnn} }}
    \caption[PIT histograms]{Probability integral transform of each model. 
    If the distribution of the PIT looks like \(U(0,1)\), it's probabilistically calibrated.}%
    \label{fig:pit}%
\end{figure}

Because the models act differently at each hour, it makes sense 
to look at the PIT histograms for each hour separately. 
The PIT histograms broken down into each hour are shown in Figure \ref{fig:pit-qrf-by-hour}, Figure \ref{fig:pit-nnqf-by-hour}, 
Figure \ref{fig:pit-deepar-by-hour} and Figure \ref{fig:pit-sqf-rnn-by-hour} 
while Figure \ref{fig:pit} shows the PIT histograms averaged over each hour.

One can observe that the PIT histogram of QRF (\ref{fig:pit-qrf}) and NNQF (\ref{fig:pit-nnqf}) are approximately 
\(U(0,1)\)-distributed but the forecasts during the night are overdispersed in the QRF case and 
skewed in the NNQF model.
The DeepAR and SQF-RNN model perform similarly: they are both skewed with a high density at \(0\). 
This means that the actual output lies often in the lower quantiles of the prediction. 