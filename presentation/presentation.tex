\documentclass[10pt,aspectratio=169]{beamer}

\usetheme[progressbar=frametitle]{metropolis}

\include{preamble}

\title{Non-Parametric Machine Learning Models for Solar Energy Forecasting}
% \subtitle{}
\date{16.07.2021}
\author{Pavel Zwerschke}
\institute{Karlsruhe Institute of Technology}
% \titlegraphic{\hfill\includegraphics[height=1.5cm]{logo.pdf}}

\begin{document}

\maketitle

\begin{frame}{Table of contents}
    \setbeamertemplate{section in toc}[sections numbered]
    \tableofcontents%[hideallsubsections]
\end{frame}

\begin{frame}{Introduction}
    \begin{itemize}
        \item Solar energy generation is characterized by fluctuations due to uncertainty of the weather
        \item Uncertainty should be quantified through a probabilistic forecast
        \begin{itemize}
            \item Probabilistic forecasts for solar energy generation are underdeveloped
            \item[\(\leadsto\)] We want to compare different machine learning based forecasting models on solar power
        \end{itemize}
    \end{itemize}
\end{frame}

\section{Model descriptions}

\begin{frame}{NNQF}
    \begin{center}
        \includegraphics{plots/nnqf_approach.pdf}
    \end{center}
    \begin{itemize}
        \item Let \(x_1, \ldots, x_n \in \R^D\) be the predictors and \(y_1, \ldots, y_n\in \R\) the target values.
        \item Calculate approximate quantiles of \(y_i\):
        \begin{itemize}
            \item Find \(N\) nearest neighbors of \(x_i\): \(\set{y_{i_1}, \ldots, y_{i_N}}\)
            \item Calculate the empirical quantiles \(y_{(0.01)}, \ldots, y_{(0.99)}\) from \(\set{y_{i_1}, \ldots, y_{i_N}}\)
        \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}{NNQF}
    \begin{itemize}
        \item After modification of training set, a data mining technique is used for learning the map \(f(x) = (y_{(0.01)}, \ldots, y_{(0.99)})\).
        \item High correlation of adjacent data points \(\leadsto\) don't just use \(x_i\) for prediction of \(y_i\), but also 
        \(x_{i-1}, \ldots, x_{i-H+1}\)
    \end{itemize}
\end{frame}

\begin{frame}{Advantages of NNQF}
    \begin{itemize}
        \item \(q\) is a free parameter and can be changed to any \(q\in (0,1)\)
        \item the regression technique is not specified, any technique can be used
        \item nearest neighbor calculation only needs to be done once
        \item the original dataset does not need to be saved
    \end{itemize}
\end{frame}

\begin{frame}{QRF}
    \begin{itemize}
        \item Use bagging to produce \(k\) trees from training set \(x_1, \ldots, x_n \in \R^D\) and \(y_1, \ldots, y_n \in \R\)
        \item For \(x\in \R^D\), we want to predict the distribution \(\P(Y | X=x)\)
        \begin{itemize}
            \item Calculate \(\hat{y}_1, \ldots, \hat{y}_k\) from the trees 
            \item Calculate the empirical quantiles \(\hat{y}_{(q)}\) of \(\set{\hat{y}_1, \ldots, \hat{y}_k}\) for any \(q \in (0,1)\)
        \end{itemize}
        \item[\(\leadsto\)] Basically like Random Forests but instead of calculating the mean, you calculate the quantiles of the prediction
    \end{itemize}
\end{frame}

\begin{frame}[fragile]{DeepAR -- Training}
    \begin{center}
    \begin{tikzpicture}[yscale=-1,node distance=-\pgflinewidth]
        \tikzset{ReceptorNode/.style={circle, draw=black, fill=lightblue, thick, inner sep=2pt, minimum size=30pt}}
        \tikzset{Placeholder/.style={circle, thick, inner sep=2pt, minimum size=30pt}}
        \tikzset{Connection/.style={->, line width=0.5mm}}
        \newcommand{\mynode}[3]{
            \node[ReceptorNode] (circ-#2) at (#1, 0) {\(\boldsymbol{h}_{#2}\)};
            \node (x-#2) at (#1, 1.5) {\(x_{#2}, z_{#3}\)};
            \node (y-#2) at (#1, -1.5) {\(\P(z_{#2}|h_{#2})\)};

            \draw[Connection] (circ-#2) -- (y-#2);
            \draw[Connection] (x-#2)    -- (circ-#2);
        }
        \newcommand{\placeholder}[2]{
            \node[Placeholder] (circ-#2) at (#1, 0) {\(\cdots\)};
            \node (x-#2) at (#1, 1.5) {};
            \node (y-#2) at (#1, -1.5) {};
        }
        \newcommand{\connect}[2]{
            \draw[Connection] (y-#1)    -- (circ-#2);
            \draw[Connection] (circ-#1) -- (circ-#2);
        }

        % Create nodes
        \mynode{1 * 2.5}{1}{0}
        \onslide<2->{
            \mynode{2 * 2.5}{2}{1}
            \connect{1}{2}
        }
        \onslide<3->{
            \mynode{3 * 2.5}{3}{2}
            \connect{2}{3}
        }
        \onslide<4->{
            \placeholder{4 * 2.5}{4}
            \connect{3}{4}
        }
        % Last node is called "n"
        \onslide<5->{
            \mynode{5*2.5}{n}{n-1}
            \connect{4}{n}
        }
    \end{tikzpicture}
    \end{center}
    \begin{itemize}
        \item Autoregressive Recurrent Neural Network with probabilistic output
        \item \(x_t\) and \(z_{t-1}\) form with \(\boldsymbol{h}_{t-1}\) the new network output \(\boldsymbol{h}_t\)
        which is used to compute \(\theta_t\) and the likelihood \(\P(z_t | \theta_t)\)
    \end{itemize}
\end{frame}

\begin{frame}[fragile]{DeepAR -- Predicting}
    \begin{center}
    \begin{tikzpicture}[yscale=-1,node distance=-\pgflinewidth]
        \tikzset{ReceptorNode/.style={circle, draw=black, fill=lightblue, thick, inner sep=2pt, minimum size=30pt}}
        \tikzset{Placeholder/.style={circle, thick, inner sep=2pt, minimum size=30pt}}
        \tikzset{Connection/.style={->, line width=0.5mm}}
        \newcommand{\mynode}[3]{
            \node[ReceptorNode] (circ-#2) at (#1, 0) {\(\boldsymbol{h}_{#2}\)};
            \node (x-#2) at (#1, 1.5) {\(x_{#2}, z_{#3}\)};
            \node (y-#2) at (#1, -1.5) {\(\P(z_{#2}|h_{#2})\)};

            \draw[Connection] (circ-#2) -- (y-#2);
            \draw[Connection] (x-#2)    -- (circ-#2);
        }
        \newcommand{\mynodewithresult}[3]{
            \node[ReceptorNode] (circ-#2) at (#1, 0) {\(\boldsymbol{h}_{#2}\)};
            \node (x-#2) at (#1, 1.5) {\(x_{#2}, z_{#3}\)};
            \node (y-#2) at (#1, -1.5) {\(\P(z_{#2}|h_{#2})\)};
            \node (z-#2) at (#1, -2.5) {\(\tilde{z}_{#2}\)};

            \draw[Connection] (circ-#2) -- (y-#2);
            \draw[Connection] (x-#2)    -- (circ-#2);
            \draw[Connection] (y-#2)    -- (z-#2);
        }
        \newcommand{\mynodewithresultinputsampled}[3]{
            \node[ReceptorNode] (circ-#2) at (#1, 0) {\(\boldsymbol{h}_{#2}\)};
            \node (x-#2) at (#1, 1.5) {\(x_{#2}, \tilde{z}_{#3}\)};
            \node (y-#2) at (#1, -1.5) {\(\P(z_{#2}|h_{#2})\)};
            \node (z-#2) at (#1, -2.5) {\(\tilde{z}_{#2}\)};

            \draw[Connection] (circ-#2) -- (y-#2);
            \draw[Connection] (x-#2)    -- (circ-#2);
            \draw[Connection] (y-#2)    -- (z-#2);
        }
        \newcommand{\placeholder}[2]{
            \node[Placeholder] (circ-#2) at (#1, 0) {\(\cdots\)};
            \node (x-#2) at (#1, 1.5) {};
            \node[opacity=0] (y-#2) at (#1, -1.5) {\(\P(z_{#2}|h_{#2})\)};
        }
        \newcommand{\connect}[2]{
            \draw[Connection] (y-#1)    -- (circ-#2);
            \draw[Connection] (circ-#1) -- (circ-#2);
        }

        % Create nodes
        \mynode{1 * 2.5}{T}{T-1}
        \draw[Connection] ([xshift=-0.5cm]circ-T.west) -- (circ-T);
        \onslide<2->{
            \mynodewithresult{2 * 2.5}{T+1}{T}
            \connect{T}{T+1}
        }
        \onslide<3->{
            \mynodewithresultinputsampled{3 * 2.5}{T+2}{T+1}
            \connect{T+1}{T+2}
        }
        \onslide<4->{
            \placeholder{4 * 2.5}{T+3}
            \connect{T+2}{T+3}
        }
        % Last node is called "T+n"
        \onslide<5->{
            \mynodewithresultinputsampled{5*2.5}{T+n}{T+n-1}
            \connect{T+3}{T+n}
        }
    \end{tikzpicture}
    \end{center}
    \begin{itemize}
        \onslide<2->{\item Generate \(\tilde{z}_t \sim \P(\cdot | \theta_t)\) for testing from previous step}
    \end{itemize}
\end{frame}

\begin{frame}{SQF-RNN}
    \begin{itemize}
        \item Output distribution is given by monotonously increasing linear splines: 
        \[ s(x; \gamma, b, d) = \gamma + \sum_{l=0}^L b_l (x - d_l)_+ \]
        \item Arbitrary distribution can be fit \(\leadsto\) no assumption on distribution
    \end{itemize}
\end{frame}

\section{Comparison}

\begin{frame}{Pinball loss}
    
\end{frame}

\begin{frame}{Energy score}
    
\end{frame}

\begin{frame}{Feature importance}
    
\end{frame}

\section{Conclusion}

\begin{frame}{Conclusion}
    
\end{frame}

\end{document}